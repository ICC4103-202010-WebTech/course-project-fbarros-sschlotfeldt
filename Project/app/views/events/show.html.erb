<p id="notice"><%= notice %></p>

<head>
  <title>Events</title>
</head>
<body>
  <div>
    <%@event.each do |v| %>
    <div class="row">
      <div class="col-3 bg-dark"></div>
      <div class="col-6">
        <%if v.event_pic.attached? %>
          <%= link_to image_tag(v.event_pic, width: "800px", height: "400px"), url_for(v)%>
        <%else %>
          <%=link_to image_tag("thumbnail.svg", width: "100%", height: "450px", background: "#55595c", color: "#eceeef"), url_for(v) %>
        <%end %>
        <div class = user_box >

          <p class ="p_user"><strong>Name:  </strong> <%=v.title%><br></p>
          <%if v.user.userName == "Null" %>
            <%@event_o.each do |x|%>
              <%if x.id == v.organization_id %>
                  <p class ="p_user"><strong>Host:  </strong> <%=x.org_homepage.name%><br></p>
              <%end %>
            <%end %>
          <%else %>
              <p class ="p_user"><strong>Host:  </strong> <%=v.user.userName%><br></p>
          <%end %>
          <p class ="p_user"><strong>Venue:  </strong> <%=@event_v.find(v.venue_id).name%></p>
          <p class ="p_user"><strong>Description:  </strong>  <%=v.description%><br></p>
          <p class ="p_user"><strong>Creation Date:  </strong> <%=v.created_at%></p>
          <p class ="p_user"><strong>Public:  </strong> <%=v.visibility%></p>
        </div>

            <%=form_tag votes_path %>
        <table><h2>Choose your available dates!:</h2>
          <%for vo in @votes %>
                  <tr>
                    <td><%= check_box("date_selected", "$dates_selected[]", {multiple:true}, vo.date) %></td>
                    <td><%=vo.date%></td>
                  </tr>
                <%end %>
            </table><br>
        <%=submit_tag "Im on!" %>
        <br>
        <div>
          <h2>Event Members : </h2>
          <%@event_members.each do |em|%>
            <%if em.event_id == v.id%>
              <ul>
                <%if @mem.include? @event_users.find(em.user_id-1).name%>
                  <%flash[:alert]= 'Ya fue Agregado al Evento'%>
                <%else %>
                  <%=@event_users.find(em.user_id-1).name %>
                  <%@mem<<@event_users.find(em.user_id-1).name %>
                <%end%>
              </ul>
            <%end%>
          <%end%>

          <h2>Event photos uploaded:</h2>
          <div align="left">
            <% if v.photos.attached?  %>
              <% v.photos.each do |photos| %>
                <%= image_tag(photos, width: "200px")%>
              <% end %>
            <%else %>
            <%end %>
          </div>

          <h2>Event files uploaded:</h2>
          <div align="left">
            <% if v.files.attached?  %>
              <% v.files.each do |file| %>
                <%= link_to file.filename, url_for(file) %><br>
              <% end %>
            <%else %>
            <%end %>
          </div>

          <h2>Event videos uploaded:</h2>
          <div align="left">
            <% if v.videos.attached?  %>
              <% v.videos.each do |video| %>
                <%= video_tag(rails_blob_path(video),:size => "320x240", :controls => true) %>
            <%end %>
          <%end %>
          </div>

        </div >
          <%if @mem.include? @event_users.find($current_user[0].id-1).name%>
            <div align="right">
              <tr>
                <td> <button class="btn btn-light"><%=link_to 'Comments', comment_path(v.id)%></button></td>
                <td><button class="btn btn-light"><%=link_to 'Exit event', edit_event_event_m_path(v.id)%></button></td>
                <td><%@mem.delete(@event_users.find($current_user[0].id-1).name) %></td>
              </tr>
            </div>
          <%else%>
            <div align="right">
              <button align="left" class="btn btn-light"><%=link_to 'Comments', comment_path(v.id)%></button>
              <button class="btn btn-light"><%=link_to 'Join event', new_event_event_m_path(v.id)%></button></td>
            </div>
          <%end%>

      </div>
      <div class="col-3 bg-dark"></div>
    </div>
    <%end%>

    <%@event.each do |v| %>
    <%if v.user_id == $current_user[0].id %>
    <div class="row-2">
      <div class="col-3 bg-dark"></div>
      <div class="col-6">
          <div align="right" >
            <button class="btn btn-light"><%=link_to 'Invite Users', event_invites_path(v.id)%></button>
          </div>
        </div>
      <div class="col-3 bg-dark"></div>
    </div>
    <%end%>
    <%end%>
  </div>

</body>


<footer>
  <div class="row-3">
    <div align="right">
      <% if $current_user[0].id == @event[0].user_id %>
        <button class="btn"><%= link_to 'Edit', edit_event_path(@event.ids) %></button>
        <button class="btn"><%= link_to 'Back', events_path %></button>
      <%else%>
        <button class="btn"><%= link_to 'Back', events_path %></button>
      <%end%>
    </div>
  </div>
</footer>
